# 编译原理课程设计

## 一、课程介绍

课程性质：必修课

要求：每个同学必须修读并完成相应的设计要求。

------

## 二、课程设计任务

1. 按课程设计任务书的具体要求进行完成。
2. 课程设计实验报告书要按《课程设计实验报告书版头及正文格式》文件中的格式书写。
3. **完成方法**：每个学生独立完成。
4. **上交内容**：
   - 课程设计源程序
   - 课程设计实验报告书
   - 系统使用说明书
   - 课程设计系统的可执行程序
   - 测试文本及测试源程序
   - 测试报告
   - 课程设计报告讲解视频
5. **技术要求**：所设计的系统应该是一个**窗口式图形界面**的应用程序，且系统实现所采用的编程语言只能是 **C/C++** 语言。
6. 需遵循课程设计进度安排。

------

## 三、实验内容回顾：词法分析 (实验2)

### 1. 实验目标

设计一个应用软件，实现：

正则表达式 $\rightarrow$ NFA $\rightarrow$ DFA $\rightarrow$ DFA最小化 $\rightarrow$ 词法分析程序 (选做)

### 2. 必做实验内容及要求

1. **正则支持**：正则表达式应支持命名操作，运算符号包括：转义符号(`\`)、连接、选择(`|`)、闭包(`*`)、正闭包(`+`)、`[]`、可选(`?`)、括号`()`。
2. **编辑界面**：提供源程序编辑界面，支持输入单行或多行正则表达式（支持保存、打开文件）。
3. **NFA 查看**：提供窗口查看转换得到的 NFA（用状态转换表呈现即可）。
4. **DFA 查看**：提供窗口查看转换得到的 DFA（用状态转换表呈现即可）。
5. **最小化 DFA 查看**：提供窗口查看转换得到的最小化 DFA（用状态转换表呈现即可）。
6. **界面**：应用程序需为窗口式图形界面。
7. **文档**：书写完善的软件文档。

### 3. 选做实验内容及要求

将最小化得到的 DFA 图转换为词法分析源程序（C/C++描述）。

- **约束**：只能采用讲稿中的“转换方法一”或“转换方法二”来生成源程序。
- **界面**：提供窗口查看生成的词法分析源程序。

### 4. 输入格式示例

Plaintext

```
digit=[0-9]
letter=[A-Za-z]
num100=(\+|-)?digit+
ID101=letter(letter|digit)*
specail200s=\+|-|\*|/|=|<|<=|<<
```

**说明：**

1. 命名中加下划线 (如 `_ID101`) 表示该正则表达式需要生成 DFA 图。
2. 名字后的数值为对应单词的编码。
3. 数值后加 `S` 表示后面有多个单词，但编码从该数值开始递增。
4. 转义说明：由于 `+` 和 `*` 已被用作闭包运算，作为普通字符（正号、乘号）使用时需加 `\` 转义。

### 5. 转换过程输出示例

#### (1) 正则表达式 $\rightarrow$ NFA

输出 NFA 图或对应的状态转换表。

(示例表格数据)

| 状态 | letter | digit | # (Epsilon) |

| :--- | :--- | :--- | :--- |

| 1 | 2 | | |

| 2 | | | 3 |

| 3 | | | 4, 10 |

| 4 | | | 5, 7 |

| 5 | | 6 | |

| ... | ... | ... | ... |

#### (2) NFA $\rightarrow$ DFA

输出 DFA 图或对应的状态转换表。

| 状态集合 | letter | digit |

| :--- | :--- | :--- |

| {1} | {2,3,4,5,7,10} | |

| {2,3,4,5,7,10} | {6,9,4,7,10,5} | {8,9,4,3,5,10} |

| ... | ... | ... |

#### (3) DFA 最小化

输出最小化 DFA 图或状态转换表。

#### (4) 生成 DFA 词法分析程序 (C/C++)

**方法一 (逻辑判断法)：**

C++

```
int Judgechar (char ch) {
    if (isalpha(ch)) return 1;
    else if (isdigit(ch)) return 0;
    return -1;
}

char GetNext(){ return buffer[pos++]; }

void GetToken() {
    if (Judgechar(ch)==1) {
        ch=GetNext();
        while ((Judgechar(ch)==1) || (Judgechar(ch)==0))
            ch=GetNext();
        cout<<"ID";
    }
    else cout<<"Error";
}
```

**方法二 (状态机 Switch-Case 法)：**

C++

```
void GetToken() {
    int state = 1;
    bool done = false;
    while (!done) {
        switch (state) {
            case 1:
                if (Judgechar(ch) == 1) {
                    state = 2;
                    ch = GetNext();
                } else {
                    cout << "Error!";
                    return;
                }
                break;
            case 2:
                if ((Judgechar(ch) == 1) || (Judgechar(ch) == 0))
                    ch = GetNext();
                else
                    done = true;
                break;
        }
    }
    cout << "ID";
}
```

------

## 四、课程设计的第一项任务要求 (总结)

1. **输入**：文本文件输入（格式自定义）。
2. **正则运算**：支持 `\` `|` `*` `+` `[]` `?` `()` 及命名。
3. **编辑**：提供编辑界面。
4. **展示**：分别提供窗口展示 NFA、DFA、最小化 DFA。
5. **代码生成**：将最小化 DFA 转为 C/C++ 源程序（仅限指定方法）。
6. **编译执行**：对生成的源码进行编译，并以测试源程序输入，输出单词编码。
7. **系统测试流程**：
   - (A) 以 **TINY 语言**正则为输入，生成 TINY 词法分析器源码。
   - (B) 编译该源码生成可执行程序。
   - (C) 用 `sample.tny` 测试，输出 `sample.lex`。

### 第一项任务测试数据：TINY 语言

1. 关键词 (不区分大小写)

if then else end repeat until read write

2. 专用符号

\+ - * / % ^ < > <= >= = { } ; :=

**3. 标识符 (Identifier) 和 数字 (Number)**

- `identifier = letter (letter | digit)*` (字母开头，不区分大小写)
- `number = digit+`
- `letter = [a-zA-Z]`
- `digit = [0-9]`
- 注释

用 {} 表示，可跨行，不可嵌套。

------

## 五、课程设计的第二项任务 (实验4 LR(1)分析生成器)

### 1. 任务目标

设计一个应用软件，实现：

BNF 文法 $\rightarrow$ First/Follow 集合 $\rightarrow$ LR(0) DFA $\rightarrow$ 判断 SLR(1) $\rightarrow$ LR(1) DFA $\rightarrow$ LR(1) 分析表 $\rightarrow$ 语法分析与语法树生成。

### 2. 具体要求

1. **输入**：以文本文件方式输入 BNF 文法，提供编辑/打开界面。
2. **集合计算**：求出 First 和 Follow 集合，以表格形式分别呈现。
3. **LR(0) DFA**：生成并查看 LR(0) DFA 图（图或表格）。
4. **SLR(1) 判断**：判断是否为 SLR(1)，若不是需显示原因。
5. **LR(1) DFA**：生成并查看 LR(1) DFA 图。
6. **LR(1) 分析表**：生成并查看分析表（表格形式）。
7. **语法分析**：打开源程序（任务一生成的编码文件），用 LR(1) 方法逐行分析，显示分析过程。
8. **语法树**：在分析过程中生成语法树，并以树状形式呈现。
9. **测试**：以 **TINY 语言**的所有语法及 `sample.lex` 进行测试。
10. **选做**：生成某种中间代码。

### 3. 第二项任务测试数据：TINY 语言文法

BNF

```
program -> stmt-sequence
stmt-sequence -> stmt-sequence ; statement | statement
statement -> if-stmt | repeat-stmt | assign-stmt | read-stmt | write-stmt
if-stmt -> if exp then stmt-sequence end | if exp then stmt-sequence else stmt-sequence end
repeat-stmt -> repeat stmt-sequence until exp
assign-stmt -> identifier := exp
read-stmt -> read identifier
write-stmt -> write exp
exp -> simple-exp comparison-op simple-exp | simple-exp
comparison-op -> < | > | = | >= | <= | <>
simple-exp -> simple-exp addop term | term
addop -> + | -
term -> term mulop factor | factor
mulop -> * | / | % | ^
factor -> ( exp ) | number | identifier
```

------

## 六、课程设计的第三项任务 (Mini-C 测试)

在前两项任务完成后，进行以下综合测试：

1. 以 **Mini-C 语言**的词法进行测试，编写至少一个 Mini-C 源程序进行词法分析。
2. 以 **Mini-C 语言**的语法进行测试，使用步骤(1)生成的单词编码文件进行语法分析，生成对应的语法树。

------

## 七、课程设计进度安排

| **时间**            | **进度安排**                                                 |
| ------------------- | ------------------------------------------------------------ |
| **第1周**           | 任课老师进行课程设计介绍                                     |
| **第1周 ~ 第5周**   | 完成**第一项任务**（软件设计及报告），并以 Tiny 语言进行词法测试及书写测试报告 |
| **第6周 ~ 第10周**  | 完成**第二项任务**（软件设计及报告），并以 Tiny 语言进行语法测试及书写测试报告 |
| **第11周 ~ 第13周** | 1. 以 **Mini-C** 进行整个系统的功能测试（含词法、语法），书写测试报告   2. 完成实验报告整合和自评   3. 完成系统使用说明书   4. 录制讲解视频（15分钟） |
| **第14周**          | **提交资料**：源程序、测试文本/程序、测试报告、可执行程序、使用说明书、报告书、讲解视频。  **截止时间**：第14周周五晚上12点前（砺儒云课堂）。 |
| **第15 ~ 17周**     | 1. 抽查、评分   2. 被抽查同学需到学院实验室解释相关工作      |

------

## 八、讲解视频录制注意事项

1. **时长**：总时长 15-20 分钟。
   - 系统演示时间限制：若视频总长15分钟，演示限2分钟；若总长20分钟，演示可达7分钟。
2. **露面要求**：
   - **开头**：露面讲解标题、学号、姓名、年级班级。
   - **结尾**：露面致谢。
   - *建议*：视频全程有小视窗露面。
3. **准备**：需先制作 PPT 讲稿再录制。
4. **大小**：视频文件不超过 **100MB**（必要时请压缩）。

------

## 九、课程设计评分标准

**总分构成**：系统和文档 (45%) + 运行及测试 (45%) + 讲解视频 (10%)。需均达到及格标准。

- **E < 60**：必做功能累计未能完成超过 3/5。
- **60 < D < 70**：上交所有材料。必做功能完成 > 3/5 但未全完成。视频思路完整，文档规范，界面基本符合要求。
- **70 < C < 80**：完成**所有必做功能**（除选做外）。视频符合要求，文档规范，代码风格好，界面美观。
- **80 < B < 90**：完成**所有必做功能**及**部分选做内容**。视频清晰，文档规范，设计思想清晰，界面美观方便。
- **90 < A < 100**：完成**所有必做功能**及**全部选做内容**。功能完善，视频十分清晰，文档十分规范，设计思想十分清晰，界面美观方便。